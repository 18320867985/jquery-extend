<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>文件上传-h5file</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/all.css" />
    <link rel="stylesheet" type="text/css" href="css/icon/iconfont.css" />
</head>

<body class="review">

    <!--content -->
    <section class="clearfix container relative  common-cnt container">

        <!--content-->
        <div class="member-content ">
            <h1>文件上传-h5file</h1>
            <div>
                <a class="btn-link" href="./js/v-h5file.js">查看 v-h5file.js</a>
                <a class="btn-link" href="./component-scss/v-h5file.scss">查看 v-h5file.scss</a>
            </div>

            <div class="content" id="form2">

                <div class="identity">
                    <div class="infor">
                        <span class="icon">*</span>
                        <span>身份证正反面：</span>
                    </div>
                    <div class="identity-wrap">
                        <div class="identity-front-img bg v-h5file-box">
                            <div class="btn-wrap">
                                <div class="btn">
                                    <span class="v-h5file-box-btn">上传正面</span>
                                        <input class="v-h5file-file" type="file"  accept="image/png, image/jpeg, image/gif, image/jpg">
                                            
                                        <!--accept="image/png, image/jpeg, image/gif, image/jpg"-->
                                </div>
                            </div>

                            <!-- 文件上传的进度条 -->
                            <div class=" v-h5file-all d-hide">
                                <div class="v-h5file-bar">
                                    <div class="v-h5file-now"></div>
                                    <div class="v-h5file-num">0%</div>
                                </div>

                            </div>
                            <!-- 文件上传的成功显示图片 -->
                            <img class="v-h5file-img" src="" alt="h5上传图片" data-id="personpicz">
                            <input class="v-h5file-src " type="text" name="personpicz" vd-req vd-req-msg="身份证正反面不能为空">

                        </div>
                        <span class="tips">(建议上传尺寸：272 * 170PX）</span>

                    </div>
                    <div class="identity-wrap">
                        <div class="identity-back-img bg v-h5file-box ">
                            <div class="btn-wrap">
                                <div class="btn">
                                    <span  class="v-h5file-box-btn">上传反面</span>
                                    <input class="v-h5file-file" type="file"
                                        accept="image/png, image/jpeg, image/gif, image/jpg">
                                </div>
                            </div>
                            <!-- 文件上传的进度条 -->
                            <div class=" v-h5file-all d-hide">
                                <div class="v-h5file-bar">
                                    <div class="v-h5file-now"></div>
                                    <div class="v-h5file-num">0%</div>
                                </div>

                            </div>
                            <!-- 文件上传的成功显示图片 -->
                            <img class="v-h5file-img" src="" alt="h5上传图片" data-id="personpicf">
                            <input class="v-h5file-src vd-item" type="text" name="personpicf" vd-req
                                vd-req-msg="身份证反面不能为空">

                        </div>
                        <span class="tips">(建议上传尺寸：272 * 170PX）</span>

                    </div>
                </div>

                <div class="license">
                    <div class="infor">
                        <span class="icon">*</span>
                        <span>营业执照：</span>
                    </div>

                    <div class="license-wrap">
                        <div class="license-img bg  v-h5file-box">
                            <div class="btn-wrap">
                                <div class="btn">
                                    <span  class="v-h5file-box-btn">上传执照</span>
                                    <input class="v-h5file-file" type="file"
                                        accept="image/png, image/jpeg, image/gif, image/jpg">
                                </div>
                            </div>
                            <!-- 文件上传的进度条 -->
                            <div class=" v-h5file-all d-hide">
                                <div class="v-h5file-bar">
                                    <div class="v-h5file-now"></div>
                                    <div class="v-h5file-num">0%</div>
                                </div>

                            </div>
                            <!-- 文件上传的成功显示图片 -->
                            <img class="v-h5file-img" src="" alt="h5上传图片" data-id="businesspic">
                            <input class="v-h5file-src vd-item" type="text" name="businesspic" vd-req
                                vd-req-msg="营业执照不能为空">

                        </div>
                        <span class="tips">(建议上传尺寸：宽：272PX ）</span>

                    </div>


                </div>

                <div class="shopPhoto">


                    <div class="infor">
                        <span class="icon">*</span>
                        <span>店铺照片：</span>
                    </div>

                    <div class="shopPhoto-wrap">
                        <div class="shopPhoto-img bg  v-h5file-box vd-box">
                            <div class="btn-wrap">
                                <div class="btn">
                                    <span class="v-h5file-box-btn">上传店铺</span>
                                    <input class="v-h5file-file" type="file"
                                        accept="image/png, image/jpeg, image/gif, image/jpg">
                                </div>
                            </div>
                            <!-- 文件上传的进度条 -->
                            <div class=" v-h5file-all d-hide">
                                <div class="v-h5file-bar">
                                    <div class="v-h5file-now"></div>
                                    <div class="v-h5file-num">0%</div>
                                </div>

                            </div>
                            <!-- 文件上传的成功显示图片 -->
                            <img class="v-h5file-img" src="" alt="h5上传图片" data-id="companypic">
                            <input class="v-h5file-src vd-item" type="text" name="companypic" vd-req
                                vd-req-msg="店铺照片不能为空">
                        </div>
                        <span class="tips">(建议上传尺寸：宽：272PX ）</span>

                    </div>
                </div>

                <!-- <a href="index.html" class="back">返回</a> -->
                <a class="submit vd-btn">提交审核</a>
            </div>

            <pre>
                html: 
                &lt;div class="v-h5file-box">
                    &lt;div class="btn-wrap">
                            &lt;div class="btn">
                                &lt;span  class="v-h5file-box-btn">上传执照&lt;/span>
                                &lt;input class="v-h5file-file" type="file" accept="image/png, image/jpeg, image/gif, image/jpg">        
                            &lt;/div>
                    &lt;/div>
                    &lt;!-- 文件上传的进度条 -->
                    &lt;div class=" v-h5file-all d-hide">
                         &lt;div class="v-h5file-bar">
                            &lt;div class="v-h5file-now">&lt;/div>
                            &lt;div class="v-h5file-num">0%&lt;/div>
                        &lt;/div>
                    &lt;/div>
                    <!-- 文件上传的成功显示图片 -->
                    &lt;img class="v-h5file-img" src="" alt="h5上传图片" >
                    &lt;input class="v-h5file-src" type="text"  >
                &lt;/div>
     
             </pre>
             <pre>
                 js code:
                 $(function () {

                    $(".v-h5file-img").click(function (e) {
                        $(this).parents(".v-h5file-box").find(".v-h5file-file").click();
                    });
            
                    $(".v-h5file-box-btn").click(function(){
                       var p=$(this).parents(".v-h5file-box ");
                        $(".v-h5file-file",p).click();
                    });
            
                    // 文件上传
                    $(".v-h5file-file").change(function (e) {
                        e.preventDefault();
                        var obj = this;
            
                        // 是否支持html5 文件上传
                        if (typeof obj.files === "undefined") {
                            alert("不支持html5 文件上传,请升级你的浏览器  \n not support html5 ");
                            return;
                        }
                        var file = obj.files[0];
            
                        // 文件大小限定
                        var size = 300 * 1000000; //1m=1000000
                        if (file.size > size) {
                            alert("选择上传的文件大于" + size / 1000000 + "M");
                            return;
                        }
                        var p = $(obj).parents(".v-h5file-box");
                        var $progressBar = $(".v-h5file-all", p);
                        $progressBar.show();
            
                        window.vh5File.upload({
                                data: file, //选择的文件
                                url:"//weixin.sujin1688.com/sjbj/index.php/home/H5file/uploadfile", //上传网址
                                outTime: 30000,
                                dataType: "text",
                                el: obj, //当前element
                                contentType: false,
                                success: function (data) {
            
                                    var src = "//weixin.sujin1688.com/sjbj" + data;
                                    $(".v-h5file-img", p).attr("src", src).show();
                                    $(".v-h5file-src", p).val(data);
                                    console.log(src);
                                }, //成功回调
                                error: function () {
                                    $(".v-h5file-img", p).hide();
                                    alert("上传发生错误")
                                }, //错误回调
            
            
                            }, function (evt) {
            
                                var width = $(".v-h5file-bar", p).width();
                                var percentageDiv = $(".v-h5file-now", p);
                                var percentageNum = $(".v-h5file-num", p);
            
                                if (evt.lengthComputable) {
                                    $progressBar.max = evt.total;
                                    $progressBar.value = evt.loaded;
                                    $(percentageDiv).css("width", Math.round(evt.loaded / evt.total * width) +
                                        "px");
                                    $(percentageNum).text(Math.ceil(evt.loaded / evt.total * 100) + "%");
            
                                  
                                }
                            } // progress事件的回调函数
            
                        ); //调用上传接口
            
            
                    });
                });

             </pre>
     

        </div>


    </section>

</body>
<!-- <script src="js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script> -->
<script src="js/mobile/mobile-dom.js" type="text/javascript" charset="utf-8"></script>
<script src="js/mobile/mobile-ajax.js" type="text/javascript" charset="utf-8"></script>
<script src="js/v-h5file.js" type="text/javascript" charset="utf-8"></script>

<script>
    $(function () {

        $(".v-h5file-img").click(function (e) {
         
            $(this).parents(".v-h5file-box").find(".v-h5file-file").click();
        });

        $(".v-h5file-box-btn").click(function(){
       
           var p=$(this).parents(".v-h5file-box");
          
            $(".v-h5file-file",p).click();
        });

        // 文件上传
        $(".v-h5file-file").change(function (e) {
            e.preventDefault();
            var obj = this;

            // 是否支持html5 文件上传
            if (typeof obj.files === "undefined") {
                alert("不支持html5 文件上传,请升级你的浏览器  \n not support html5 ");
                return;
            }
           
            var file = obj.files[0];
            // 文件大小限定
            var size = 300 * 1000000; //1m=1000000
            if (file.size > size) {
                alert("选择上传的文件大于" + size / 1000000 + "M");
                return;
            }
            var p = $(obj).parents(".v-h5file-box");
            var $progressBar = $(".v-h5file-all", p);
            $progressBar.show();

            window.vh5File.upload({
                    data: file, //选择的文件
                    url:"//weixin.sujin1688.com/sjbj/index.php/home/H5file/uploadfile", //上传网址
                    outTime: 30*1000,
                    dataType: "text",
                    el: obj, //当前element
                   contentType:false,
                   processData:false,
                    success: function (data) {

                        var src = "//weixin.sujin1688.com/sjbj" + data;
                        $(".v-h5file-img", p).attr("src", src).show();
                        $(".v-h5file-src", p).val(data);
                      //  console.log(src);
                    }, //成功回调
                    error: function (err) {
                        $(".v-h5file-img", p).hide();
                        alert(err)
                    }, //错误回调


                }, function (evt) {

                    var width = $(".v-h5file-bar", p).width();
                    var percentageDiv = $(".v-h5file-now", p);
                    var percentageNum = $(".v-h5file-num", p);

                    if (evt.lengthComputable) {
                        $progressBar.max = evt.total;
                        $progressBar.value = evt.loaded;
                        $(percentageDiv).css("width", Math.round(evt.loaded / evt.total * width) +
                            "px");
                        $(percentageNum).text(Math.ceil(evt.loaded / evt.total * 100) + "%");

                      
                    }
                } // progress事件的回调函数

            ); //调用上传接口


        });
    });
</script>

</html>